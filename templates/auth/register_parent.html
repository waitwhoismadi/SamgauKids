{% extends "base.html" %}

{% block title %}Parent Registration - {{ super() }}{% endblock %}

{% block content %}
<div class="min-vh-100 bg-gradient py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                <div class="text-center mb-5">
                    <div class="d-inline-flex align-items-center bg-white rounded-pill px-4 py-2 shadow-soft mb-4">
                        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 32px; height: 32px;">
                            <i class="bi bi-people-fill text-white"></i>
                        </div>
                        <span class="fw-semibold text-gray-700">Parent Registration</span>
                        <i class="bi bi-arrow-right mx-3 text-gray-400"></i>
                        <span class="text-gray-400">Add Children</span>
                        <i class="bi bi-arrow-right mx-3 text-gray-400"></i>
                        <span class="text-gray-400">Start Exploring</span>
                    </div>
                    <h1 class="display-5 fw-bold text-gray-800 mb-3">
                        Create Your <span class="text-primary">Family Account</span>
                    </h1>
                    <p class="lead text-muted">
                        Join thousands of families in Astana who trust SamgauKids for their children's education
                    </p>
                </div>
                
                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-large rounded-3xl">
                            <div class="card-body p-5">
                                <div class="d-flex align-items-center mb-4">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3" 
                                         style="width: 60px; height: 60px;">
                                        <i class="bi bi-person-plus text-primary fs-4"></i>
                                    </div>
                                    <div>
                                        <h3 class="fw-bold text-gray-800 mb-1">Parent Information</h3>
                                        <p class="text-muted mb-0">Tell us about yourself to get started</p>
                                    </div>
                                </div>
                                
                                <form method="POST" class="needs-validation" novalidate>
                                    <div class="form-section mb-5">
                                        <h5 class="fw-bold text-gray-700 mb-4 d-flex align-items-center">
                                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 24px; height: 24px;">
                                                <span class="text-white small fw-bold">1</span>
                                            </div>
                                            Personal Information
                                        </h5>
                                        
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label for="name" class="form-label fw-semibold">Full Name *</label>
                                                <div class="input-group">
                                                    <span class="input-group-text bg-gray-50 border-end-0">
                                                        <i class="bi bi-person text-primary"></i>
                                                    </span>
                                                    <input type="text" 
                                                           class="form-control border-start-0 bg-gray-50" 
                                                           id="name" 
                                                           name="name" 
                                                           placeholder="Enter your full name"
                                                           required>
                                                    <div class="invalid-feedback">
                                                        Please provide your full name.
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="phone" class="form-label fw-semibold">Phone Number</label>
                                                <div class="input-group">
                                                    <span class="input-group-text bg-gray-50 border-end-0">
                                                        <i class="bi bi-telephone text-success"></i>
                                                    </span>
                                                    <input type="tel" 
                                                           class="form-control border-start-0 bg-gray-50" 
                                                           id="phone" 
                                                           name="phone" 
                                                           placeholder="+7 (XXX) XXX-XX-XX">
                                                </div>
                                                <small class="text-muted">We'll use this to contact you about your children's programs</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-section mb-5">
                                        <h5 class="fw-bold text-gray-700 mb-4 d-flex align-items-center">
                                            <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 24px; height: 24px;">
                                                <span class="text-white small fw-bold">2</span>
                                            </div>
                                            Account Information
                                        </h5>
                                        
                                        <div class="row g-4">
                                            <div class="col-12">
                                                <label for="email" class="form-label fw-semibold">Email Address *</label>
                                                <div class="input-group">
                                                    <span class="input-group-text bg-gray-50 border-end-0">
                                                        <i class="bi bi-envelope text-info"></i>
                                                    </span>
                                                    <input type="email" 
                                                           class="form-control border-start-0 bg-gray-50" 
                                                           id="email" 
                                                           name="email" 
                                                           placeholder="your@email.com"
                                                           required>
                                                    <div class="invalid-feedback">
                                                        Please provide a valid email address.
                                                    </div>
                                                </div>
                                                <small class="text-muted">This will be your username for SamgauKids</small>
                                            </div>
                                            <div class="col-12">
                                                <label for="password" class="form-label fw-semibold">Password *</label>
                                                <div class="input-group">
                                                    <span class="input-group-text bg-gray-50 border-end-0">
                                                        <i class="bi bi-lock text-warning"></i>
                                                    </span>
                                                    <input type="password" 
                                                           class="form-control border-start-0 bg-gray-50" 
                                                           id="password" 
                                                           name="password" 
                                                           placeholder="Create a secure password"
                                                           required>
                                                    <button class="btn btn-outline-secondary border-start-0" 
                                                            type="button" 
                                                            onclick="togglePassword()">
                                                        <i class="bi bi-eye" id="toggleIcon"></i>
                                                    </button>
                                                    <div class="invalid-feedback">
                                                        Password must be at least 8 characters long.
                                                    </div>
                                                </div>
                                                <div class="password-strength mt-2">
                                                    <div class="progress" style="height: 4px;">
                                                        <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
                                                    </div>
                                                    <small class="text-muted" id="passwordStrengthText">Enter a password to see strength</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-section mb-5">
                                        <h5 class="fw-bold text-gray-700 mb-4 d-flex align-items-center">
                                            <div class="bg-warning rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 24px; height: 24px;">
                                                <span class="text-white small fw-bold">3</span>
                                            </div>
                                            Location Information
                                        </h5>
                                        
                                        <div class="row g-4">
                                            <div class="col-12">
                                                <label for="address" class="form-label fw-semibold">Home Address</label>
                                                <div class="input-group">
                                                    <span class="input-group-text bg-gray-50 border-end-0">
                                                        <i class="bi bi-geo-alt text-danger"></i>
                                                    </span>
                                                    <input type="text" 
                                                           class="form-control border-start-0 bg-gray-50" 
                                                           id="address" 
                                                           name="address" 
                                                           placeholder="Enter your address in Astana">
                                                    <button class="btn btn-outline-primary border-start-0" 
                                                            type="button" 
                                                            onclick="getCurrentLocation()">
                                                        <i class="bi bi-crosshair"></i>
                                                    </button>
                                                </div>
                                                <small class="text-muted">
                                                    <i class="bi bi-info-circle me-1"></i>
                                                    We'll use this to show you nearby education centers
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-section mb-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
                                            <label class="form-check-label text-muted" for="terms">
                                                I agree to the <a href="#" class="text-primary text-decoration-none">Terms of Service</a> 
                                                and <a href="#" class="text-primary text-decoration-none">Privacy Policy</a>
                                            </label>
                                            <div class="invalid-feedback">
                                                You must agree to the terms and conditions.
                                            </div>
                                        </div>
                                        <div class="form-check mt-2">
                                            <input class="form-check-input" type="checkbox" id="newsletter" name="newsletter">
                                            <label class="form-check-label text-muted" for="newsletter">
                                                Send me updates about new programs and education opportunities in Astana
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-3">
                                        <button type="submit" class="btn btn-primary btn-lg py-3 fw-semibold">
                                            <i class="bi bi-person-plus me-2"></i>
                                            Create Family Account
                                        </button>
                                        <div class="text-center">
                                            <p class="text-muted mb-0">
                                                Already have an account? 
                                                <a href="{{ url_for('auth.login') }}" class="text-primary fw-semibold text-decoration-none">
                                                    Sign in here
                                                </a>
                                            </p>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-soft rounded-xl mb-4">
                            <div class="card-body p-4">
                                <h5 class="fw-bold text-gray-800 mb-3">
                                    <i class="bi bi-star-fill text-warning me-2"></i>
                                    Why Families Love SamgauKids
                                </h5>
                                
                                <div class="benefit-item d-flex mb-3">
                                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" 
                                         style="width: 40px; height: 40px; flex-shrink: 0;">
                                        <i class="bi bi-map text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-1">Interactive Map Search</h6>
                                        <p class="text-muted small mb-0">Find the perfect education centers near your home with our beautiful map interface</p>
                                    </div>
                                </div>
                                
                                <div class="benefit-item d-flex mb-3">
                                    <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3" 
                                         style="width: 40px; height: 40px; flex-shrink: 0;">
                                        <i class="bi bi-shield-check text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-1">Verified Centers</h6>
                                        <p class="text-muted small mb-0">All education centers are verified for quality, safety, and excellent teaching standards</p>
                                    </div>
                                </div>
                                
                                <div class="benefit-item d-flex mb-3">
                                    <div class="bg-warning rounded-circle d-flex align-items-center justify-content-center me-3" 
                                         style="width: 40px; height: 40px; flex-shrink: 0;">
                                        <i class="bi bi-lightning text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-1">Instant Enrollment</h6>
                                        <p class="text-muted small mb-0">Enroll your children in programs with just a few clicks - no more paperwork hassles</p>
                                    </div>
                                </div>
                                
                                <div class="benefit-item d-flex">
                                    <div class="bg-info rounded-circle d-flex align-items-center justify-content-center me-3" 
                                         style="width: 40px; height: 40px; flex-shrink: 0;">
                                        <i class="bi bi-headset text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-1">Local Support</h6>
                                        <p class="text-muted small mb-0">Our dedicated support team in Astana is here to help you every step of the way</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card border-0 shadow-soft rounded-xl">
                            <div class="card-body p-4 text-center">
                                <h5 class="fw-bold text-gray-800 mb-4">
                                    <i class="bi bi-graph-up text-success me-2"></i>
                                    Trusted by Families
                                </h5>
                                
                                <div class="row g-3">
                                    <div class="col-6">
                                        <div class="bg-primary bg-opacity-10 rounded-xl p-3">
                                            <div class="h4 fw-bold text-primary mb-1">500+</div>
                                            <small class="text-muted">Happy Families</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-success bg-opacity-10 rounded-xl p-3">
                                            <div class="h4 fw-bold text-success mb-1">50+</div>
                                            <small class="text-muted">Verified Centers</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-warning bg-opacity-10 rounded-xl p-3">
                                            <div class="h4 fw-bold text-warning mb-1">200+</div>
                                            <small class="text-muted">Active Programs</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="bg-info bg-opacity-10 rounded-xl p-3">
                                            <div class="h4 fw-bold text-info mb-1">4.9</div>
                                            <small class="text-muted">App Rating</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4 pt-3 border-top">
                                    <div class="d-flex justify-content-center">
                                        {% for i in range(5) %}
                                        <i class="bi bi-star-fill text-warning me-1"></i>
                                        {% endfor %}
                                    </div>
                                    <p class="text-muted small mt-2 mb-0">
                                        "SamgauKids made finding the perfect music classes for my daughter so easy!"
                                    </p>
                                    <p class="fw-semibold small mb-0">- Aida K., Parent</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.bg-gradient {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.rounded-3xl {
    border-radius: 1.5rem !important;
}

.rounded-xl {
    border-radius: 0.75rem !important;
}

.shadow-large {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
}

.shadow-soft {
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
}

.text-gray-800 {
    color: var(--gray-800) !important;
}

.text-gray-700 {
    color: var(--gray-700) !important;
}

.bg-gray-50 {
    background-color: var(--gray-50) !important;
}

.border-gray-200 {
    border-color: var(--gray-200) !important;
}

.input-group-text {
    border-color: var(--gray-200);
}

.form-control {
    border-color: var(--gray-200);
    transition: all 0.3s ease;
}

.form-control:focus {
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-section {
    position: relative;
}

.form-section::after {
    content: '';
    position: absolute;
    bottom: -1rem;
    left: 2rem;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, var(--gray-200), transparent);
}

.form-section:last-of-type::after {
    display: none;
}

.benefit-item {
    transition: all 0.3s ease;
    padding: 0.5rem;
    border-radius: 0.75rem;
}

.benefit-item:hover {
    background-color: var(--gray-50);
    transform: translateX(4px);
}

.password-strength .progress-bar {
    transition: all 0.3s ease;
}

.min-vh-100 {
    min-height: 100vh;
}

.was-validated .form-control:valid {
    border-color: var(--success-500);
}

.was-validated .form-control:invalid {
    border-color: var(--danger-500);
}

.form-check-input:checked {
    background-color: var(--primary-600);
    border-color: var(--primary-600);
}

.fade-in {
    animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(20px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

@media (max-width: 768px) {
    .min-vh-100 {
        min-height: auto;
        padding: 1rem 0;
    }
    
    .card-body {
        padding: 2rem !important;
    }
    
    .display-5 {
        font-size: 2rem;
    }
}
</style>

<script>
function checkPasswordStrength(password) {
    let strength = 0;
    let text = '';
    let color = '';
    
    if (password.length >= 8) strength += 25;
    if (password.match(/[a-z]/)) strength += 25;
    if (password.match(/[A-Z]/)) strength += 25;
    if (password.match(/[0-9]/)) strength += 25;
    
    if (strength < 50) {
        text = 'Weak password';
        color = 'bg-danger';
    } else if (strength < 75) {
        text = 'Good password';
        color = 'bg-warning';
    } else {
        text = 'Strong password';
        color = 'bg-success';
    }
    
    return { strength, text, color };
}

function togglePassword() {
    const passwordInput = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('bi-eye');
        toggleIcon.classList.add('bi-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('bi-eye-slash');
        toggleIcon.classList.add('bi-eye');
    }
}

function getCurrentLocation() {
    const button = event.target;
    const originalIcon = button.innerHTML;
    
    button.innerHTML = '<i class="bi bi-arrow-clockwise spin"></i>';
    button.disabled = true;
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                showNotification('Location detected! We\'ll help you find nearby centers.', 'success');
                button.innerHTML = '<i class="bi bi-check-circle text-success"></i>';
                setTimeout(() => {
                    button.innerHTML = originalIcon;
                    button.disabled = false;
                }, 2000);
            },
            function(error) {
                showNotification('Could not detect location. Please enter your address manually.', 'warning');
                button.innerHTML = originalIcon;
                button.disabled = false;
            }
        );
    } else {
        showNotification('Geolocation is not supported by this browser.', 'error');
        button.innerHTML = originalIcon;
        button.disabled = false;
    }
}

function showNotification(message, type) {
    const alertClass = type === 'error' ? 'danger' : type;
    const iconClass = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle';
    
    const alert = document.createElement('div');
    alert.className = `alert alert-${alertClass} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3`;
    alert.style.zIndex = '9999';
    alert.innerHTML = `
        <i class="bi bi-${iconClass} me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alert);
    
    setTimeout(() => {
        if (alert.parentNode) {
            alert.remove();
        }
    }, 5000);
}

(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const result = checkPasswordStrength(password);
    
    const strengthBar = document.getElementById('passwordStrength');
    const strengthText = document.getElementById('passwordStrengthText');
    
    strengthBar.style.width = result.strength + '%';
    strengthBar.className = `progress-bar ${result.color}`;
    strengthText.textContent = result.text;
});

document.querySelector('form').addEventListener('submit', function(e) {
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<i class="bi bi-arrow-clockwise spin me-2"></i>Creating your account...';
    submitBtn.disabled = true;
});

document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.startsWith('7')) {
        value = value.substring(1);
    }
    
    if (value.length > 0) {
        if (value.length <= 3) {
            value = `+7 (${value}`;
        } else if (value.length <= 6) {
            value = `+7 (${value.substring(0, 3)}) ${value.substring(3)}`;
        } else {
            value = `+7 (${value.substring(0, 3)}) ${value.substring(3, 6)}-${value.substring(6, 8)}-${value.substring(8, 10)}`;
        }
    }
    
    e.target.value = value;
});

const style = document.createElement('style');
style.textContent = `
    .spin {
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`;
document.head.appendChild(style);

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.card, .benefit-item').forEach((el, index) => {
        el.style.animationDelay = `${index * 0.1}s`;
        el.classList.add('fade-in');
    });
});
</script>
{% endblock %}